# syntax=docker/dockerfile:1
FROM ghcr.io/ontherivt/pgvector-postgis:pg16

# Disable durability for test speed (unsafe for prod)
RUN echo "fsync = off" >> /var/lib/postgresql/data/postgresql.conf && \
    echo "synchronous_commit = off" >> /var/lib/postgresql/data/postgresql.conf && \
    echo "full_page_writes = off" >> /var/lib/postgresql/data/postgresql.conf && \
    echo "wal_level = minimal" >> /var/lib/postgresql/data/postgresql.conf && \
    echo "shared_buffers = 512MB" >> /var/lib/postgresql/data/postgresql.conf && \
    echo "work_mem = 64MB" >> /var/lib/postgresql/data/postgresql.conf && \
    echo "maintenance_work_mem = 256MB" >> /var/lib/postgresql/data/postgresql.conf && \
    echo "effective_cache_size = 1GB" >> /var/lib/postgresql/data/postgresql.conf && \
    echo "random_page_cost = 1" >> /var/lib/postgresql/data/postgresql.conf && \
    echo "seq_page_cost = 1" >> /var/lib/postgresql/data/postgresql.conf
